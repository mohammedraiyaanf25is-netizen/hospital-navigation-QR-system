var e,t;e=this,t=function(){"use strict";function e(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=function(){function t(n){var r=this;e(this,t),this.$canvas=document.createElement("canvas"),this.$canvas.style.display="none",this.$canvas.width=n.videoWidth,this.$canvas.height=n.videoHeight,this.$ctx=this.$canvas.getContext("2d",{alpha:!1}),this._video=n,this._stop=!1,this._onDecode=null,this._active=!1,this._scan=function(){if(!r._stop){try{r.$ctx.drawImage(r._video,0,0,r.$canvas.width,r.$canvas.height);var e=r.$ctx.getImageData(0,0,r.$canvas.width,r.$canvas.height);r._worker.postMessage({type:"decode",data:e})}catch(e){}requestAnimationFrame(r._scan)}}}return r(t,[{key:"setWorker",value:function(e){this._worker=e,this._worker.onmessage=this._onWorkerMessage.bind(this)}},{key:"onDecode",value:function(e){this._onDecode=e}},{key:"start",value:function(){var e=this;this._stop=!1,this._active||(this._active=!0,navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(n){e._video.srcObject=n,e._video.setAttribute("playsinline",!0),e._video.play(),requestAnimationFrame(e._scan)}))}},{key:"stop",value:function(){this._stop=!0,this._active=!1,this._video.srcObject&&this._video.srcObject.getTracks().forEach(function(e){return e.stop()})}},{key:"_onWorkerMessage",value:function(e){"qrResult"===e.data.type&&this._onDecode&&this._onDecode(e.data.data)}}]),t}(),i=function(){function t(n,r){var o=this;e(this,t),this.$video=n,this._onResult=r,this._scanner=new o.Scanner(n),this._worker=new Worker(t.WORKER_PATH),this._scanner.setWorker(this._worker),this._scanner.onDecode(function(e){o._onResult(e)})}return r(t,[{key:"start",value:function(){this._scanner.start()}},{key:"stop",value:function(){this._scanner.stop()}}]),t}();return i.WORKER_PATH="",i.Scanner=o,i}(),"object"==typeof exports&&"undefined"!=typeof module?module.exports=t:"function"==typeof define&&define.amd?define(t):(e.QrScanner=t);
